- name: Clean MOTD system entirely and install static version
  hosts: all
  become: true
  gather_facts: no

  tasks:
    - name: Disable PAM MOTD in sshd
      lineinfile:
        path: /etc/pam.d/sshd
        regexp: '^session\s+optional\s+pam_motd\.so'
        state: absent

    - name: Disable PAM MOTD in login
      lineinfile:
        path: /etc/pam.d/login
        regexp: '^session\s+optional\s+pam_motd\.so'
        state: absent

    - name: Remove update-motd.d and dynamic motd files
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - /etc/update-motd.d
        - /etc/motd.dynamic
        - /run/motd.dynamic

    - name: Deploy static MOTD
      copy:
        dest: /etc/motd
        content: |
          ｏｂｌｉｖｉｏｎ
        mode: '0644'

    - name: Ensure SSH doesn't print MOTD itself
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^PrintMotd'
        line: 'PrintMotd no'
        create: true

    - name: Restart SSH
      service:
        name: ssh
        state: restarted

