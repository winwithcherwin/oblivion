- name: Install static MOTD with color
  hosts: all
  become: true
  gather_facts: false

  tasks:

    - name: Disable PAM MOTD in sshd
      lineinfile:
        path: /etc/pam.d/sshd
        regexp: '^session\s+optional\s+pam_motd\.so'
        state: absent

    - name: Disable PAM MOTD in login
      lineinfile:
        path: /etc/pam.d/login
        regexp: '^session\s+optional\s+pam_motd\.so'
        state: absent

    - name: Remove update-motd and dynamic files
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - /etc/update-motd.d
        - /etc/motd.dynamic
        - /run/motd.dynamic

    - name: Enable static MOTD printing in SSH
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^PrintMotd'
        line: 'PrintMotd yes'
        create: true

    - name: Deploy static colorized MOTD
      copy:
        dest: /etc/motd
        content: |
          \033[1;35mｏｂｌｉｖｉｏｎ\033[0m

          Welcome.
        mode: '0644'

    - name: Restart SSH
      service:
        name: ssh
        state: restarted

