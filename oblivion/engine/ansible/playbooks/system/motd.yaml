- name: Hacker-style MOTD Setup
  hosts: all
  become: true
  gather_facts: no

  tasks:
    - name: Remove default Ubuntu MOTD scripts
      file:
        path: "/etc/update-motd.d/{{ item }}"
        state: absent
      loop:
        - 00-header
        - 00-custom
        - 10-help-text
        - 50-motd-news
        - 50-landscape-sysinfo
        - 85-fwupd
        - 90-updates-available
        - 91-contract-ua-esm-status
        - 92-unattended-upgrades
        - 95-hwe-eol
        - 97-overlayroot
        - 98-fsck-at-reboot
        - 98-reboot-required

    - name: Install coreutils (for `numfmt` if not already present)
      apt:
        name: coreutils
        state: present
        update_cache: yes

    - name: Deploy hacker-style compact MOTD script
      copy:
        dest: /etc/update-motd.d/00-hacker
        mode: '0755'
        content: |
          #!/bin/bash
          IP=$(hostname -I | awk '{print $1}')
          WG_IP=$(ip -4 addr show wg0 2>/dev/null | awk '/inet / {print $2}' | cut -d/ -f1)
          PEERS=$(wg show wg0 2>/dev/null | grep '^peer:' | wc -l)

          UPDATES=$(apt list --upgradable 2>/dev/null | grep -v "^Listing" | wc -l)
          [[ "$UPDATES" -eq 0 ]] && STATUS="✔ System up to date" || STATUS="✖ $UPDATES updates available"

          echo "IP: $IP"
          [[ -n "$WG_IP" ]] && echo "wg0: $WG_IP | peers: $PEERS"
          echo "$STATUS"

