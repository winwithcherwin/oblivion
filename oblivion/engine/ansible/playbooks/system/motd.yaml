- name: Minimal MOTD
  hosts: localhost
  gather_facts: yes

  tasks:
    - name: Remove Ubuntu MOTD spam
      file:
        path: "/etc/update-motd.d/{{ item }}"
        state: absent
      loop:
        - 00-header
        - 10-help-text
        - 50-motd-news
        - 80-livepatch
        - 91-release-upgrade
        - 95-hwe-eol
        - 97-overlayroot
        - 98-fsck-at-reboot
        - 98-reboot-required

    - name: Create compact MOTD script
      copy:
        dest: /etc/update-motd.d/00-custom
        mode: '0755'
        content: |
          #!/bin/bash
          HOST=$(hostname)
          IP=$(hostname -I | awk '{print $1}')
          WG_IP=$(ip -4 addr show wg0 | grep -oP '(?<=inet\s)\d+(\.\d+){3}')
          LOAD=$(uptime | awk -F'load average:' '{print $2}' | cut -d, -f1 | xargs)
          MEM=$(free -m | awk '/Mem:/ { printf("%.0f", $3*100/$2) }')
          DISK=$(df -h / | awk 'NR==2 {print $5}')
          PEERS=$(wg show wg0 | grep '^peer:' | wc -l)

          echo -e "ðŸ–¥  Host: $HOST"
          echo -e "ðŸ“¡ IP: $IP | wg0: $WG_IP"
          echo -e "ðŸ“¦ Load: $LOAD | Mem: ${MEM}% | Disk: $DISK"
          echo -e "ðŸ” WireGuard: UP | Peers: $PEERS"

