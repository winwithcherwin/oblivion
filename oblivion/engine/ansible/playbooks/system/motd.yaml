- name: Minimal MOTD using /etc/motd (no pam_motd, no update-motd.d)
  hosts: all
  gather_facts: no

  tasks:

    - name: Ensure PAM does not print any MOTD
      lineinfile:
        path: /etc/pam.d/sshd
        regexp: '^session\s+optional\s+pam_motd\.so'
        state: absent

    - name: Delete all dynamic MOTD systems
      file:
        path: "{{ item }}"
        state: absent
      loop:
        - /etc/update-motd.d
        - /etc/motd.dynamic
        - /run/motd.dynamic

    - name: Enable static MOTD printing in SSHD
      lineinfile:
        path: /etc/ssh/sshd_config
        regexp: '^PrintMotd'
        line: 'PrintMotd yes'
        create: true

    - name: Write static /etc/motd
      copy:
        dest: /etc/motd
        content: |
          ｏｂｌｉｖｉｏｎ

          Welcome.
        mode: '0644'

    - name: Restart SSHD
      service:
        name: ssh
        state: restarted

