apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: registry-auth
  namespace: kube-system
spec:
  type: kv-v2
  mount: kubernetes-staging
  path: apps/kube-system/registry
  vaultAuthRef: kube-system
  destination:
    name: registry-auth
    create: true
    annotations:
      reflector.v1.k8s.emberstack.com/reflection-allowed: "true"
      reflector.v1.k8s.emberstack.com/reflection-allowed-namespaces: ".*"
      reflector.v1.k8s.emberstack.com/reflection-auto-enabled: "true"
      reflector.v1.k8s.emberstack.com/reflection-auto-namespaces: "oblivion,kpack"
    transformation:
      templates:
        dockerconfigjson:
          text: |
            {
              "auths": {
                "{{ (get .Secrets "server") }}": {
                  "username": "{{ (get .Secrets "username") }}",
                  "password": "{{ (get .Secrets "password") }}",
                  "email": "{{ (get .Secrets "email") }}"
                }
              }
            }

