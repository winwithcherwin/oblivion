{
  "builders": [
    {
      "type": "digitalocean",
      "api_token": "{{user do_token}}",
      "image": "ubuntu-24-04-x64",
      "region": "ams3",
      "size": "s-1vcpu-1gb",
      "ssh_username": "root",
      "snapshot_name": "ubuntu-24-04-updated-{{timestamp}}"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "script": "./scripts/wait-for-cloud-init.sh",
      "pause_before": "10s"
    },
    {
      "type": "shell",
      "inline": [
        "export DEBIAN_FRONTEND=noninteractive",
        "apt-get update -y",
        "apt-get install -y unattended-upgrades",
        "unattended-upgrade -d",
        "apt-get upgrade -y",
        "apt-get install -y python3-celery python3-redis redis-tools ansible"
      ]
    }
  ]
}
